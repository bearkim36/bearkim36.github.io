<!DOCTYPE html>
<html lang="ko-KR">
  <!--
  The Head
-->

<head>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7JT2Z6NPGL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7JT2Z6NPGL');
</script>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no" />
     
     
     
     
     
     
    

  <title>Github을 활용한 WebProject devops 구성 1</title>
  <meta name="title" content="Github을 활용한 WebProject devops 구성 1" />
  <meta name="author" content="Bearkim" />
  <meta name="description" content="MS가 github을 인수하고 나서 모든 개발환경에 중심에 Github이 있는 것 같다. 형상관리에서 CI/CD까지 아우르는 github생태계는 개발자들에게 새로운 영감을 준다. 하지만 역시나 한글로된 국내자료는 단편적인 부분만 있고 전반적인 devops구성에는 제대로 된 자료를 찾기가 어렵다. 애초에 devops의 자료 자체가 강호에 전설로만 내려오는 무공비급마냥 찾기 힘든게 사실이다. 이번 포스트는 나름에 시리즈로 실무에서 흔히 접할 수 있는 WebProject를 상정해 이를 구성하는 devops를 github과 github actions을 통하여 구성해보는 예제를 만들고자 한다.
" />

  
  <meta property="article:tag" content="github," />
  
  <meta property="article:tag" content="devops," />
  
  <meta property="article:tag" content="githubactions" />
  
  <meta property="article:published_time" content="2021-03-08T05:08:45+09:00" />


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">

  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/main.css">


<!-- highlight -->
  <link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/a11y-dark.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>


  <script
  src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
  integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
  crossorigin="anonymous"></script>

  <script src="/assets/js/jekyll-search.min.js" type="text/javascript"></script>


  <body>     
    <nav id="mobileNavbar" class="py-2" aria-label="mobile navigation">
      <h4>Bearkim Techlog</h4>
      <button class="btn d-inline-flex align-items-center" id="mobileToggle"> 
        
        <i class="fas fa-bars"></i>
      </button>
    </nav>
    <div id="wrap" class="container-xxl">
    <!--
  The Side Bar
-->
<aside id="sidebar">
  <h4><a href="/">Bearkim Techlog</a></h4>
  <nav class="collapse bd-links" id="bd-docs-nav" aria-label="Docs navigation">
    <ul class="list-unstyled mb-0 py-3 pt-md-1">
    <li class="mb-1">
      
    

      <button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#tech-post-collapse" aria-expanded="true" aria-current="true">
        Tech post
      </button>

      <div class="collapse show" id="tech-post-collapse">
        <ul class="list-unstyled fw-normal pb-1 small">

          
          
              
              
              <li><a href="/category/aws" class="d-inline-flex align-items-center rounded">aws<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/devops" class="d-inline-flex align-items-center rounded">devops<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/electron" class="d-inline-flex align-items-center rounded">electron<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/jekyll" class="d-inline-flex align-items-center rounded">jekyll<span class="count">(1)</span></a></li>
              
        </ul>
      </div>
    </li>
    <li class="mb-1">
      <button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#hobbies-collapse" aria-expanded="false">
        관심거리
      </button>
    </li>
    <li class="mb-1">
      <button class="btn d-inline-flex align-items-center rounded" data-bs-toggle="collapse" data-bs-target="#portfolio-collapse" aria-expanded="false">
        Portfolio
      </button>

      <div class="collapse" id="layout-collapse">
        <ul class="list-unstyled fw-normal pb-1 small">
            <li><a href="/" class="d-inline-flex align-items-center rounded">ICT</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded active" aria-current="page">Kiosk</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">ITS</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">Embeded</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">WEB</a></li>
            
        </ul>
      </div>
    </li>
    <li class="mb-1">
      <button id="aboutme" class="btn d-inline-flex align-items-center rounded collapsed">
        About
      </button>
    </li>
</ul>
</nav>
<div class="profile">
  <div class="profile-text">나는 한다, 개발을</div>
  <div class="profile-image">    
 </div>
  <hr />
    <button id="btnGithub" class="btn d-inline-flex align-items-center rounded"><i class="fab fa-github"></i></button>
    <button class="btn d-inline-flex align-items-center rounded" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-placement="top" data-bs-content="인스타 안합니다">
      <i class="fab fa-instagram" ></i>
    </button>
    
    <button class="btn d-inline-flex align-items-center rounded"   data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-placement="top" data-bs-content="가서 일해보고는 싶네요">
      <i class="fab fa-facebook-square" ></i>
    </button>

</div>
</aside>

      <div id="mobileMask"></div>      
      <div id="content">
       <!--  <div id="searchWrap">
          <ul class="search__results" id="resultsContainer"></ul>
          <div id="search">
            <input id="search-input" class="form-control mr-sm-2" type="search" placeholder="Search..." value="" />
          </div>
        </div> -->
        
        <div class="row">

  <div id="post-wrapper" class="col-12 col-lg-9 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Github을 활용한 WebProject devops 구성 1</h1>

      <div class="post-meta text-muted d-flex mb-5 justify-content-between">

        <div>
          <span class="semi-bold">
            Bearkim
          </span>
          <i class="far fa-calendar fa-fw"></i>
          Mar 08, 2021
        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>MS가 github을 인수하고 나서 모든 개발환경에 중심에 Github이 있는 것 같다. 형상관리에서 CI/CD까지 아우르는 github생태계는 개발자들에게 새로운 영감을 준다. 하지만 역시나 한글로된 국내자료는 단편적인 부분만 있고 전반적인 devops구성에는 제대로 된 자료를 찾기가 어렵다. 애초에 devops의 자료 자체가 강호에 전설로만 내려오는 무공비급마냥 찾기 힘든게 사실이다. 이번 포스트는 나름에 시리즈로 실무에서 흔히 접할 수 있는 WebProject를 상정해 이를 구성하는 devops를 github과 github actions을 통하여 구성해보는 예제를 만들고자 한다.</p>

<h5 id="overview">Overview</h5>
<ul>
  <li>Github Actions 을 이용한 자동 배포</li>
  <li><span style="color:#777777">개발과 배포에 proxy 활용하기</span></li>
  <li><span style="color:#777777">docker hub를 이용한 패키지 형상 관리</span></li>
  <li><span style="color:#777777">Github Actions과 docker hub를 이용한 자동 배포</span></li>
</ul>

<h1> </h1>
<h4 id="1-devops가-무엇인가">1. devops가 무엇인가</h4>

<p>사전적인 의미보다는 실무에서 devops는 말그대로 개발환경이다. 로컬에 개발툴을 설치하는 것도 개발환경 설정이지만 여기서 개발환경 이라고 하는 것은 CI(지속적인 소스통합), CD(지속적인 소스배포) 작업을 단순화 하기 위함이다. 다음의 작업으로 예를 들어보자.</p>

<p><img src="/assets/posts/2021-03-08/image1.png" alt="WebProject 논리 구조도" /></p>

<p>위와 같은 구조를 가진 WebProject를 개발한다고 해보자. 이 프로젝트에서는 mongodb도 초기 구축시에 기초데이터가 필요할테니 각각 3개의 소스를 개발하고 관리해야 한다.</p>

<p>이 환경에서 만약 퍼블리셔가 퍼블리싱을 수정할 일이 생겨 Frontend에 소스를 변경하고 이를 수정한 후 개발자가 이를 배포한다고 가정하면 어떻게 해야할까? 다행히 형상관리로 github은 쓰고는 상황이라면 작업은 대충 아래와 같을 것이다.</p>

<ol>
  <li>퍼블리셔가 소스를 수정하고 github에 push한다.</li>
  <li>퍼블리셔가 개발자에게 소스가 수정됐다고 알린다.</li>
  <li>개발자 (혹은 관리자)가 이 소스를 github에서 pull한다.</li>
  <li>react (혹은 vue)를 빌드한다.</li>
  <li>빌드된 소스를 scp를 써서 배포서버의 배포서버에 web root에 복사해 넣는다.</li>
  <li>반복</li>
</ol>

<p>이와같은 상황을 가정하고 이번 포스트에서는 react로 개발된 frontend의 devops를 구성하는 방법에 대해 설명한다.</p>

<h1 id="-1"> </h1>
<h4 id="2-그럼-어떻게-개선할-것인가">2. 그럼 어떻게 개선할 것인가</h4>

<p>무엇을 만들던 간에 목표가 제일 중요하다. 프로젝트 마다 처한 상황과 환경이 다르기 때문에 무엇이 최적이라고 할 수는 없지만 그걸 합리적으로 설계하는 것이 devops설계의 핵심이다. 이번에 예제로 할 WebProject는 다음의 상황을 가정한다.</p>

<ol>
  <li>ssh로 접근할 수 있는 리눅스 배포 서버가 있다.</li>
  <li>소스는 github으로 형상관리 중이다.</li>
  <li>같은소스를 다른 서버에 포팅 할 일은 없다.</li>
  <li>코드 업데이트가 꽤 빈번히 일어난다.</li>
  <li>개발 조직이 소규모이다.</li>
  <li>보안상의 문제로 ssh는 pem키 파일을 써서 접속한다.</li>
</ol>

<p>위와 같은 프로젝트 상황이라고 가정한 후 devops를 설계해 보는 예제를 설명해 보겠다.</p>

<h1 id="-2"> </h1>
<h4 id="3-반복해서-하는-일은-github-actions이-한다">3. 반복해서 하는 일은 github actions이 한다.</h4>

<p>앞서 설명한 예제에서 코드 수정과 배포는 꽤 잦은 일이지만 위에 상황에서는 사람이 매번 그 작업을 하고있다. 이번에 설계하는 devops는 그 작업을 github actions에게 맡기는 것이다. 그럼 위 예제에서 반복되는 작업은 <strong>소스 업데이트 시 빌드하고 배포서버에 복사하는 작업</strong> 이 될것이다. 그럼 실제 Frontend 소스의 배포작업에서 쓰는 쉘 스크립트는 다음과 같다.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 소스 가져오기</span>
<span class="nv">$ </span>git pull
remote: Enumerating objects: <span class="k">*</span>, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span><span class="k">*</span>/<span class="k">*</span><span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
... 중략
<span class="c"># 누가 모듈을 추가했을지도 모르니 의존성 설치</span>
<span class="nv">$ </span>npm <span class="nb">install</span>
<span class="c"># 빌드</span>
<span class="nv">$ </span>npm run build
<span class="c"># 배포서버로 포팅</span>
<span class="c"># scp -i pem키파일 -r build/. ssh 접속가능 계정@배포서버 IP나 DNS:nginx html 루트</span>
<span class="nv">$ </span>scp <span class="nt">-i</span> sshkey.pem <span class="nt">-r</span> build/. sshaccount@deploy.server.com:/usr/share/nginx/html/
</code></pre></div></div>

<p>그럼 이 작업들을 github actions에게 떠넘겨보자.</p>

<p>일단은 각각의 프로젝트 내부에 .github/workflows 라는 디렉토리를 만든다. 그리고 이 안에 yml파일을 만든다. 파일명은 크게 상관없다.</p>

<p><img src="/assets/posts/2021-03-08/image2.png" alt="yml 디렉토리 구조" /></p>

<p>이 파일을 에디터로 열어서 수정한다.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#frontend yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Front-end CI</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>    
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">node-version</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">14.x</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># source checkout</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

      <span class="c1"># nodejs 설치</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Use Node.js $</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="s">$</span>
      
      <span class="c1"># module 설치</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">npm install</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">npm install</span>

      <span class="c1"># 소스 빌드</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Npm run build</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">npm run build</span>

      <span class="c1"># scp 파일 복사</span>
      <span class="c1"># secret.키 이름 은 github repository 시크릿 키이다. </span>
      <span class="c1"># 구글링 해도 쉽게 나오지만 간단하게 설명하면 </span>
      <span class="c1"># github repository 상단메뉴 &gt; settings &gt; secrets 에 new respositry secret 버튼으로 </span>
      <span class="c1"># 노출하기 싫은 환경변수를 저장할 수 있다.</span>

      <span class="c1"># 아래 스크립트는 build에 있는 파일을 배포서버의 웹서버 루트에 복사해 넣는 액션이다.</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">scp action</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">appleboy/scp-action@master</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">host</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">port</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">build"</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">devops_test"</span>

</code></pre></div></div>

<p><img src="/assets/posts/2021-03-08/image03.png" alt="액션 실행 완료" /></p>

<p><img src="/assets/posts/2021-03-08/image04.png" alt="파일 업로드 완료" /></p>

<p>이 과정에서 테스트를 한다거나 파일배치를 옮긴다거나 디테일을 추가 할 수는 있지만 이 것은 나중에 추가로 포스트를 작성할 계획이다. 일단 여기까지.</p>

<p>참고 예제
https://github.com/bearkim36/devops-frontend-example</p>

<h1 id="-3"> </h1>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/devops/'>devops</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
   
          <div>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">github,</button>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">devops,</button>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">githubactions</button>
            
          </div>

          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
       
        </div>
      </div>

    </div> 


  </div> 


  <div class="col-12 col-lg-3 col-xl-4">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->




  
    
    
      
      
        
        
        
      
    
  
    
    
      
      
        
        
        
      
    
  
    
    
  
    
    
      
      
        
        
        
      
    
  





  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h4 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>관련 포스트</h4>
    <div class="card-deck mb-4">
    
      
      
      <div class="card mb-1">
        <a href="/posts/jekyll-category/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Jekyll Category 메뉴바와 페이지 적용하기</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Mar 08, 2021
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card mb-1">
        <a href="/posts/vue_electron_sqlite_knex/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Vue.js와 Electron, sqlite3와 knex 개발환경 구성</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Mar 08, 2021
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card mb-1">
        <a href="/posts/s3fsremount/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>s3fs로 mount한 S3의 AccessKey를 변경하는 방법</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Mar 08, 2021
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
  <div class="card-deck mb-4">
    
    <h4 class="pt-2 mt-1 mb-4 ml-1"
    data-toc-skip>이전 포스트</h4>

    <div class="card">
      <a href="/posts/s3fsremount/" 
    prompt="previous">
        <div class="card-body">           
          <h6 class="pt-0 mt-1 mb-3" data-toc-skip>s3fs로 mount한 S3의 AccessKey를 변경하는 방법</h6>
          <div class="text-muted small">
            <i class="far fa-calendar fa-fw"></i>
            Jun 07, 2020
          </div>
        </div>
      </a>
    </div>
  
  
  <h4 class="pt-2 mt-1 mb-4 ml-1"
  data-toc-skip>다음 포스트</h4>

  <div class="card">
    <a href="/posts/vue_electron_sqlite_knex/" 
    prompt="next">
      <div class="card-body">           
        <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Vue.js와 Electron, sqlite3와 knex 개발환경 구성</h6>
        <div class="text-muted small">
          <i class="far fa-calendar fa-fw"></i>
          May 18, 2021
        </div>
      </div>
    </a>
  </div>

  </div> <!-- .card-deck -->
</div> <!-- #related-posts -->



    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->

      </div>
  </div>
  <script>hljs.highlightAll();</script>

<!-- bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>
  $("#mobileToggle").click((e) => {
    $("#mobileMask").show(1000);
    $("#sidebar").show(1000);
  })
  $("#mobileMask").click((e) => {
    $("#mobileMask").hide()
    $("#sidebar").hide()
  });
  $(window).resize((e)=> {
    console.log();
    if ($(document).width() > 768) {
      $("#sidebar").show()
    }
    else {     
      $("#sidebar").hide()
      $("#mobileMask").hide()
    }
  }) 
 
  $("#btnGithub").click((e)=> {
    window.open(
      'https://github.com/bearkim36',
      '_blank' 
    );
  })

  $("#aboutme").click((e) => {
    location.href="/about"
  });
  const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
  const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
  })
</script>
  </body>
</html>
