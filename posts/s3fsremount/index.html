<!DOCTYPE html>
<html lang="ko-KR">
  <!--
  The Head
-->

<head>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7JT2Z6NPGL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7JT2Z6NPGL');
</script>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no" />
     
     
     
     
     
     
    

  <title>s3fs로 mount한 S3의 AccessKey를 변경하는 방법</title>
  <meta name="title" content="s3fs로 mount한 S3의 AccessKey를 변경하는 방법" />
  <meta name="author" content="Bearkim" />
  <meta name="description" content="AWS S3를 s3fs로 마운트하여 사용하는 중에, IAM정책을 바꿔서 AccessKey를 변경 할일이 생겼다. 이 경우에는 두개의 파일에서 IAM AccessKey를 변경해야 한다. 단순한 작업이지만 google에 검색해도 한글자료는 안나와서 포스팅한다.

 
1. IAM계정을 추가하고 다음의 정책을 설정해준다
" />

  
  <meta property="article:tag" content="aws," />
  
  <meta property="article:tag" content="s3," />
  
  <meta property="article:tag" content="awss3," />
  
  <meta property="article:tag" content="s3fs" />
  
  <meta property="article:published_time" content="2020-06-07T23:33:45+09:00" />


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">

  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/main.css">


<!-- highlight -->
  <link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/styles/a11y-dark.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.1.0/build/highlight.min.js"></script>


  <script
  src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
  integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
  crossorigin="anonymous"></script>

  <script src="/assets/js/jekyll-search.min.js" type="text/javascript"></script>


  <body>     
    <nav id="mobileNavbar" class="py-2" aria-label="mobile navigation">
      <h4>Bearkim Techlog</h4>
      <button class="btn d-inline-flex align-items-center" id="mobileToggle"> 
        
        <i class="fas fa-bars"></i>
      </button>
    </nav>
    <div id="wrap" class="container-xxl">
    <!--
  The Side Bar
-->
<aside id="sidebar">
  <h4><a href="/">Bearkim Techlog</a></h4>
  <nav class="collapse bd-links" id="bd-docs-nav" aria-label="Docs navigation">
    <ul class="list-unstyled mb-0 py-3 pt-md-1">
    <li class="mb-1">
      
    

      <button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#tech-post-collapse" aria-expanded="true" aria-current="true">
        Tech post
      </button>

      <div class="collapse show" id="tech-post-collapse">
        <ul class="list-unstyled fw-normal pb-1 small">

          
          
              
              
              <li><a href="/category/aws" class="d-inline-flex align-items-center rounded">aws<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/devops" class="d-inline-flex align-items-center rounded">devops<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/electron" class="d-inline-flex align-items-center rounded">electron<span class="count">(1)</span></a></li>
              
              
              <li><a href="/category/jekyll" class="d-inline-flex align-items-center rounded">jekyll<span class="count">(1)</span></a></li>
              
        </ul>
      </div>
    </li>
    <li class="mb-1">
      <button class="btn d-inline-flex align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#hobbies-collapse" aria-expanded="false">
        관심거리
      </button>
    </li>
    <li class="mb-1">
      <button class="btn d-inline-flex align-items-center rounded" data-bs-toggle="collapse" data-bs-target="#portfolio-collapse" aria-expanded="false">
        Portfolio
      </button>

      <div class="collapse" id="layout-collapse">
        <ul class="list-unstyled fw-normal pb-1 small">
            <li><a href="/" class="d-inline-flex align-items-center rounded">ICT</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded active" aria-current="page">Kiosk</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">ITS</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">Embeded</a></li>
            <li><a href="/" class="d-inline-flex align-items-center rounded">WEB</a></li>
            
        </ul>
      </div>
    </li>
    <li class="mb-1">
      <button id="aboutme" class="btn d-inline-flex align-items-center rounded collapsed">
        About
      </button>
    </li>
</ul>
</nav>
<div class="profile">
  <div class="profile-text">나는 한다, 개발을</div>
  <div class="profile-image">    
 </div>
  <hr />
    <button id="btnGithub" class="btn d-inline-flex align-items-center rounded"><i class="fab fa-github"></i></button>
    <button class="btn d-inline-flex align-items-center rounded" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-placement="top" data-bs-content="인스타 안합니다">
      <i class="fab fa-instagram" ></i>
    </button>
    
    <button class="btn d-inline-flex align-items-center rounded"   data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-placement="top" data-bs-content="가서 일해보고는 싶네요">
      <i class="fab fa-facebook-square" ></i>
    </button>

</div>
</aside>

      <div id="mobileMask"></div>      
      <div id="content">
       <!--  <div id="searchWrap">
          <ul class="search__results" id="resultsContainer"></ul>
          <div id="search">
            <input id="search-input" class="form-control mr-sm-2" type="search" placeholder="Search..." value="" />
          </div>
        </div> -->
        
        <div class="row">

  <div id="post-wrapper" class="col-12 col-lg-9 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>s3fs로 mount한 S3의 AccessKey를 변경하는 방법</h1>

      <div class="post-meta text-muted d-flex mb-5 justify-content-between">

        <div>
          <span class="semi-bold">
            Bearkim
          </span>
          <i class="far fa-calendar fa-fw"></i>
          Jun 07, 2020
        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>AWS S3를 s3fs로 마운트하여 사용하는 중에, IAM정책을 바꿔서 AccessKey를 변경 할일이 생겼다. 이 경우에는 두개의 파일에서 IAM AccessKey를 변경해야 한다. 단순한 작업이지만 google에 검색해도 한글자료는 안나와서 포스팅한다.</p>

<h1> </h1>
<h4 id="1-iam계정을-추가하고-다음의-정책을-설정해준다">1. IAM계정을 추가하고 다음의 정책을 설정해준다</h4>

<p>IAM계정을 설정하는 내용은 다른 포스팅이 많으므로 생략한다. 생성한 계정에 아래의 정책을 추가한다.</p>

<p><img src="/assets/posts/2020-06-07/image1.png" alt="CiecleCI Setup project Page" /></p>

<h1 id="-1"> </h1>
<h4 id="2-아래에-파일들을-수정해준다">2. 아래에 파일들을 수정해준다</h4>
<p>AWS CLI의 AccessKey와 기존에 설정된 s3fs의 AccessKey의 수정이 필요하다.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#~/.aws/credentials       // AWS CLI 설정파일</span>
<span class="o">[</span>default]
aws_access_key_id <span class="o">=</span> ABCD12345612378               <span class="c">#변경할 IAM access key</span>
aws_secret_access_key <span class="o">=</span> qwerasdf1234567891723     <span class="c">#변경할 IAM secret access key</span>


<span class="c">#/etc/passwd-s3fs       // s3fs 비밀번호</span>
ABCD12345612378:qwerasdf1234567891723         <span class="c">#변경할 IAM access key:변경할 IAM secret access key</span>
</code></pre></div></div>

<h1 id="-2"> </h1>
<h4 id="3-s3fs마운트를-해제했다가-다시-마운트한다">3. s3fs마운트를 해제했다가 다시 마운트한다</h4>

<p>마운트를 재설정하지 않은 상태에서는 기존에 마운트된 디렉토리에서 파일을 사용하려 하면 다음과 같은 오류가 발생한다.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span>: reading directory .: Operation not permitted
total 0
</code></pre></div></div>

<p>이 경우, s3fs마운트를 다시 설정하면 해결된다.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>fusermount <span class="nt">-u</span> 마운트경로
<span class="nv">$ </span><span class="nb">sudo </span>s3fs <span class="o">[</span>버킷명] <span class="o">[</span>마운트 경로] <span class="nt">-o</span> <span class="nv">use_cache</span><span class="o">=</span>/tmp <span class="nt">-o</span> allow_other <span class="nt">-o</span> <span class="nv">uid</span><span class="o">=[</span>사용자ID] <span class="nt">-o</span> <span class="nv">gid</span><span class="o">=[</span>사용자 그룹ID] <span class="nt">-o</span> <span class="nv">multireq_max</span><span class="o">=</span>20 <span class="nt">-o</span> use_path_request_style <span class="nt">-o</span> <span class="nv">url</span><span class="o">=</span>https://s3-[리전id].amazonaws.com
</code></pre></div></div>

<h1 id="-3"> </h1>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/aws/'>aws</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
   
          <div>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">aws,</button>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">s3,</button>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">awss3,</button>
            
              <button type="button" class="btn btn-sm btn-outline-secondary">s3fs</button>
            
          </div>

          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
       
        </div>
      </div>

    </div> 


  </div> 


  <div class="col-12 col-lg-3 col-xl-4">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    






<!-- Fill with the other newlest posts  -->




  
    
    
      
      
        
        
        
      
    
  
    
    
      
      
        
        
        
      
    
  
    
    
      
      
        
        
        
      
    
  
    
    
  





  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h4 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>관련 포스트</h4>
    <div class="card-deck mb-4">
    
      
      
      <div class="card mb-1">
        <a href="/posts/jekyll-category/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Jekyll Category 메뉴바와 페이지 적용하기</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Jun 07, 2020
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card mb-1">
        <a href="/posts/vue_electron_sqlite_knex/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Vue.js와 Electron, sqlite3와 knex 개발환경 구성</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Jun 07, 2020
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card mb-1">
        <a href="/posts/github_devops/">
          <div class="card-body">           
            <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Github을 활용한 WebProject devops 구성 1</h6>
            <div class="text-muted small">
              <i class="far fa-calendar fa-fw"></i>
              Jun 07, 2020
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
  <div class="card-deck mb-4">
    
  
  <h4 class="pt-2 mt-1 mb-4 ml-1"
  data-toc-skip>다음 포스트</h4>

  <div class="card">
    <a href="/posts/github_devops/" 
    prompt="next">
      <div class="card-body">           
        <h6 class="pt-0 mt-1 mb-3" data-toc-skip>Github을 활용한 WebProject devops 구성 1</h6>
        <div class="text-muted small">
          <i class="far fa-calendar fa-fw"></i>
          Mar 08, 2021
        </div>
      </div>
    </a>
  </div>

  </div> <!-- .card-deck -->
</div> <!-- #related-posts -->



    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->

      </div>
  </div>
  <script>hljs.highlightAll();</script>

<!-- bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>
  $("#mobileToggle").click((e) => {
    $("#mobileMask").show(1000);
    $("#sidebar").show(1000);
  })
  $("#mobileMask").click((e) => {
    $("#mobileMask").hide()
    $("#sidebar").hide()
  });
  $(window).resize((e)=> {
    console.log();
    if ($(document).width() > 768) {
      $("#sidebar").show()
    }
    else {     
      $("#sidebar").hide()
      $("#mobileMask").hide()
    }
  }) 
 
  $("#btnGithub").click((e)=> {
    window.open(
      'https://github.com/bearkim36',
      '_blank' 
    );
  })

  $("#aboutme").click((e) => {
    location.href="/about"
  });
  const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
  const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
  })
</script>
  </body>
</html>
